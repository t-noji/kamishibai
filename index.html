<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <meta http-equiv="content-language" content="ja">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta name="apple-mobile-web-app-capable" content="yes">
 <meta name="mobile-web-app-capable" content="yes">
 <meta name="description" content="">
 <title></title>
 <link rel="stylesheet" type="text/css" href="kamishibai.css">
 <style type="text/css">
  #repl-visible-button { position: absolute; left: 45%; z-index: 99; opacity: 0.75; }
  #repl-visible-button img { height: 1.5em; }
  #repl-box { color: white; }
 </style>
</head>
<body>
 <div id="repl-visible-button"><img src="repl.png"/></div>
 <div id="repl-box">
  <br/>
  history:<br/>
  <textarea id="history" rows=4></textarea><br>
  source:<br/>
  <textarea id="source" rows=3></textarea><br>
  <button id="DoButton">Do</button>
  return:<textarea id="result" rows=1></textarea>
 </div>
<script src="anime.js"></script>
<script src="lisp.js"></script>
<script src="kamishibai.js"></script>
<script>
'use strict'
{ // block scope //
  const $id = id=> document.getElementById(id)

  $id('DoButton').onclick = e=>{
    $id('result').value = lisp.exec($id('source').value)
    $id('history').value = $id('history').value + $id('source').value
    $id('history').scrollTop = $id('history').scrollHeight
    $id('source').value = ''
  }
  $id('source').onkeyup = e=>
    e.keyCode === 13 && !e.shiftKey &&
      (e.preventDefault(), $id('DoButton').onclick(e))
  $id('source').onkeypress =e=> e.stopPropagation()
  anime && addIn(lisp.env, {anime: anime})
  kamishibai(document.body)

  // repl visible //
  let vi = false
  const replHidden = e=>
    $id('repl-box').style.display = (vi= !vi) ? 'none' : 'block'
  $id('repl-visible-button').onclick = replHidden

  // get url param //
  const url_param = location.search.substring(1).split('&').reduce((r,s)=>{
    const kv = s.split('=')
    r[kv[0]] = kv[1]
    return r
  }, {})
  if (url_param.load) lisp.env.load(url_param.load)
  if (url_param.replbox === 'hidden') replHidden()
}
</script>
</body>
</html>
