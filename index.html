<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <meta http-equiv="content-language" content="ja">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta name="apple-mobile-web-app-capable" content="yes">
 <meta name="mobile-web-app-capable" content="yes">
 <meta name="description" content="">
 <title></title>
 <link rel="stylesheet" type="text/css" href="kamishibai.css">
 <link rel="stylesheet" type="text/css" href="terminal.css">
 <link rel="stylesheet" type="text/css" href="contextmenu.css">
 <style type="text/css">
  #repl-visible-button { position: absolute; left: 45%; z-index: 99; opacity: 0.75; }
  #repl-visible-button img { height: 1.5em; }
  #repl-box { color: white; }
  #editable-button { font-size: 130%; position: absolute; left: 55%; z-index: 99; color: white; cursor: default; text-shadow: 2px 2px rgba(0,0,0, 0.5);}
 </style>
 <script src="anime.js"></script>
 <script type="module">
import {addIn} from './nl.js'
import {mkLisp} from './lisp.js'
import {kamishibai} from './kamishibai.js'
import {mkLispTerminal} from './terminal.js'
import Movar from './Movar.js'
  const lisp = mkLisp()
  window.addIn = addIn
  window.lisp = lisp // DevTools Debugging
  const $id = id=> document.getElementById(id)
  const $classs = c=> document.getElementsByClassName(c)

  window.anime && addIn(lisp.env, {anime: window.anime})
  kamishibai(document.body, lisp)
  const term = mkLispTerminal(document.body, lisp)
  lisp.kamishibaiError = e=> term.errAlert(e.toString())

  const movar = new Movar(lisp)
  movar.visual = false
  $id('editable-button').onclick = e=> {
    if (movar.visual = !movar.visual) movar.editStart()
    else term.stdAlert(movar.editEnd())
  }

  // repl visible //
  const replHidden = e=> term.hidden()
  $id('repl-visible-button').onclick = replHidden

  // get url param //
  const url_param = location.search.substring(1).split('&').reduce((r,s)=>{
    const kv = s.split('=')
    r[kv[0]] = kv[1]
    return r
  }, {})
  if (url_param.load) lisp.env.load(url_param.load)
  if (url_param.replbox === 'hidden') replHidden()
</script>
</head>
<body>
 <div id="repl-visible-button"><img src="repl.png"/></div>
 <div id="editable-button">âœŽ</div>
</body>
</html>
